{% extends 'base.html' %}
{% load static %}

{% block title %}플랜 목록 | Much{% endblock %}

{% block content %}
<!-- User Status Bar -->
{% if user.is_authenticated %}
<div class="user-status-bar mb-4">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-8">
        <div class="user-info">
          <i class="fas fa-user-circle text-primary me-2"></i>
          <span class="fw-semibold">{{ user.first_name|default:user.username }}님의 플랜 목록</span>
          <span class="text-muted ms-2">AI 기반으로 생성된 자산 관리 플랜들을 확인하세요.</span>
        </div>
      </div>
      <div class="col-md-4 text-md-end">
        <a href="{% url 'logout' %}" class="btn btn-outline-secondary btn-sm">
          <i class="fas fa-sign-out-alt me-1"></i>로그아웃
        </a>
      </div>
    </div>
  </div>
</div>
{% endif %}

<!-- Hero Section -->
<div class="hero-section mb-5">
  <div class="hero-container">
    <div class="container">
      <div class="row align-items-center min-vh-30">
        <div class="col-lg-8">
          <div class="hero-content">
            <h1 class="hero-title">
              <i class="fas fa-list me-3"></i>내 플랜 목록
            </h1>
            <p class="hero-subtitle">
              AI 기반으로 생성된 자산 관리 플랜들을 확인하고<br>
              개인 맞춤형 재정 계획을 관리하세요.
            </p>
            <div class="hero-buttons">
              <a href="{% url 'plan:income_prediction' %}" class="btn btn-hero-primary">
                <i class="fas fa-plus me-2"></i>새 플랜 생성
              </a>
              <a href="{% url 'plan:plan_home' %}" class="btn btn-hero-secondary">
                <i class="fas fa-home me-2"></i>플랜 홈으로
              </a>
            </div>
          </div>
        </div>
        <div class="col-lg-4">
          <div class="hero-visual">
            <div class="hero-icon">
              <i class="fas fa-chart-pie"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% if plans %}
<!-- Plans Section -->
<div class="plans-section mb-5">
  <div class="container">
    <div class="row g-4">
      {% for plan in plans %}
      <div class="col-lg-6">
        <div class="plan-card">
          <div class="plan-card-header">
            <div class="plan-card-title">
              <h5 class="mb-0">
                <i class="fas fa-chart-pie me-2"></i>{{ plan.get_plan_type_display }} 플랜
              </h5>
              <small class="text-muted">{{ plan.created_at|date:"Y년 m월 d일" }}</small>
            </div>
            <span class="plan-badge">{{ plan.income_prediction.get_income_type_display }}</span>
          </div>
          <div class="plan-card-body">
            <!-- 주요 지표 -->
            <div class="plan-metrics">
              <div class="metric-item">
                <div class="metric-label">예상 월 소득</div>
                <div class="metric-value text-primary">{{ plan.income_prediction.predicted_monthly_income|floatformat:0 }}원</div>
              </div>
              <div class="metric-item">
                <div class="metric-label">월 저축 목표</div>
                <div class="metric-value text-success">{{ plan.monthly_savings|floatformat:0 }}원</div>
              </div>
            </div>

            <!-- AI 예측 정보 -->
            <div class="plan-ai-info">
              <div class="ai-metric">
                <div class="ai-metric-header">
                  <span class="ai-metric-label">AI 예측 신뢰도</span>
                  <span class="ai-metric-value">{{ plan.income_prediction.confidence_level|floatformat:1 }}%</span>
                </div>
                <div class="progress">
                  <div class="progress-bar bg-info" style="width: {{ plan.income_prediction.confidence_level }}%"></div>
                </div>
              </div>
              <div class="ai-metric">
                <div class="ai-metric-header">
                  <span class="ai-metric-label">소득 변동성</span>
                  <span class="ai-metric-value">{{ plan.income_prediction.income_volatility|floatformat:1 }}%</span>
                </div>
                <div class="progress">
                  <div class="progress-bar bg-warning" style="width: {{ plan.income_prediction.income_volatility }}%"></div>
                </div>
              </div>
            </div>

            <!-- 플랜 요약 -->
            <div class="plan-summary">
              <h6 class="plan-summary-title">플랜 요약</h6>
              <p class="plan-summary-text">{{ plan.plan_description|truncatewords:20 }}</p>
            </div>

            <!-- 신용등급 정보 -->
            <div class="plan-credit-info">
              <div class="credit-item">
                <span class="credit-label">현재 신용등급</span>
                <span class="credit-value text-info">{{ plan.current_credit_score }}</span>
              </div>
              <div class="credit-item">
                <span class="credit-label">목표 신용등급</span>
                <span class="credit-value text-success">{{ plan.target_credit_score }}</span>
              </div>
            </div>
          </div>
          <div class="plan-card-footer">
            <div class="plan-actions">
              <a href="{% url 'plan:plan_detail' plan.id %}" class="btn btn-plan-action btn-primary">
                <i class="fas fa-eye me-1"></i>상세보기
              </a>
              <a href="{% url 'plan:plan_analytics' plan.id %}" class="btn btn-plan-action btn-success">
                <i class="fas fa-chart-bar me-1"></i>분석보기
              </a>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</div>

<!-- Statistics Section -->
<div class="statistics-section mb-5">
  <div class="container">
    <div class="row">
      <div class="col-12 text-center mb-4">
        <h2 class="section-title">
          <i class="fas fa-chart-bar me-3"></i>전체 플랜 통계
        </h2>
      </div>
    </div>
    <div class="row g-4">
      <div class="col-md-3">
        <div class="stat-card text-center">
          <div class="stat-icon">
            <i class="fas fa-list" style="font-size: 2.5rem; color: #1d5091;"></i>
          </div>
          <h6 class="stat-label">총 플랜 수</h6>
          <h4 class="stat-value text-primary">{{ plans|length }}개</h4>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card text-center">
          <div class="stat-icon">
            <i class="fas fa-wallet" style="font-size: 2.5rem; color: #1d5091;"></i>
          </div>
          <h6 class="stat-label">평균 예상 월 소득</h6>
          <h4 class="stat-value text-success">
            {% widthratio plans|length 1 0 as total_income %}
            {% for plan in plans %}
            {% widthratio plan.income_prediction.predicted_monthly_income 1 1 as monthly_income %}
            {% widthratio monthly_income 1 1 as temp_income %}
            {% widthratio temp_income 1 1 as total_income %}
            {% endfor %}
            {{ total_income|floatformat:0 }}원
          </h4>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card text-center">
          <div class="stat-icon">
            <i class="fas fa-piggy-bank" style="font-size: 2.5rem; color: #1d5091;"></i>
          </div>
          <h6 class="stat-label">평균 저축률</h6>
          <h4 class="stat-value text-warning">
            {% widthratio plans|length 1 0 as total_savings_rate %}
            {% for plan in plans %}
            {% widthratio plan.target_savings_rate 1 1 as savings_rate %}
            {% widthratio savings_rate 1 1 as total_savings_rate %}
            {% endfor %}
            {{ total_savings_rate|floatformat:1 }}%
          </h4>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card text-center">
          <div class="stat-icon">
            <i class="fas fa-credit-card" style="font-size: 2.5rem; color: #1d5091;"></i>
          </div>
          <h6 class="stat-label">평균 신용등급</h6>
          <h4 class="stat-value text-info">
            {% widthratio plans|length 1 0 as total_credit_score %}
            {% for plan in plans %}
            {% widthratio plan.current_credit_score 1 1 as credit_score %}
            {% widthratio credit_score 1 1 as total_credit_score %}
            {% endfor %}
            {{ total_credit_score }}
          </h4>
        </div>
      </div>
    </div>
  </div>
</div>

{% else %}
<!-- Empty State Section -->
<div class="empty-state-section mb-5">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="empty-state-card text-center">
          <div class="empty-state-icon">
            <i class="fas fa-chart-pie"></i>
          </div>
          <h3 class="empty-state-title">아직 생성된 플랜이 없습니다</h3>
          <p class="empty-state-text">
            AI 기반 소득 예측을 통해 맞춤형 자산 관리 플랜을 생성해보세요.
          </p>
          <a href="{% url 'plan:income_prediction' %}" class="btn btn-empty-state">
            <i class="fas fa-rocket me-2"></i>첫 번째 플랜 생성하기
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
{% endif %}

{% endblock %}
