{% extends "base.html" %}
{% load static %}
{% block title %}리더보드 - Much{% endblock %}

{% block content %}


<div class="container">

  <!-- 헤더 -->
  <div class="row mb-5">
    <div class="col-12 text-center">
      <h1 class="display-5 fw-bold text-primary mb-2">
        <i class="fas fa-medal me-3"></i>리더보드
      </h1>
      <p class="text-muted">다른 사용자들과 경쟁하며 동기부여를 받아보세요!</p>
      <div class="mt-2">
        <a href="{% url 'reward:reward_home' %}" class="btn btn-outline-secondary">
          <i class="fas fa-arrow-left me-2"></i>리워드 홈으로
        </a>
      </div>
    </div>
  </div>

  <!-- 배지 스타일(골드/실버/브론즈) -->
  <style>
    .rank-badge { font-weight:700; letter-spacing:.5px; }
    .badge-gold   { background: linear-gradient(135deg,#ffda6a,#ffc107); color:#6c4a00; }
    .badge-silver { background: linear-gradient(135deg,#e9ecef,#cfd4da); color:#343a40; }
    .badge-bronze { background: linear-gradient(135deg,#e0a889,#c97a3d); color:#2b1c12; }
    .pill-rank { min-width: 38px; }
    .soft-card { border:0; box-shadow: 0 4px 16px rgba(0,0,0,.06); }
    .avatar {
      width:34px;height:34px;border-radius:50%;
      display:inline-flex;align-items:center;justify-content:center;
      background:#eef2f7;color:#6c757d;font-weight:700;
    }
  </style>

  <div class="row g-4">

    <!-- 레벨 순위 -->
    <div class="col-12 col-lg-4">
      <div class="card soft-card h-100">
        <div class="card-header d-flex align-items-center justify-content-between">
          <h5 class="mb-0"><i class="fas fa-crown text-warning me-2"></i>레벨 순위</h5>
          <span class="text-white small">가장 높은 레벨을 달성한 사용자</span>
        </div>
        <div class="card-body p-0">
          <ul class="list-group list-group-flush">
            {% for p in level_leaders %}
              <li class="list-group-item d-flex align-items-center justify-content-between">
                <div class="d-flex align-items-center gap-3">

                  <!-- 순위 배지 -->
                  {% if forloop.counter == 1 %}
                    <span class="badge badge-gold rank-badge pill-rank"><i class="fas fa-crown me-1"></i>1</span>
                  {% elif forloop.counter == 2 %}
                    <span class="badge badge-silver rank-badge pill-rank"><i class="fas fa-medal me-1"></i>2</span>
                  {% elif forloop.counter == 3 %}
                    <span class="badge badge-bronze rank-badge pill-rank"><i class="fas fa-medal me-1"></i>3</span>
                  {% else %}
                    <span class="badge bg-light text-muted pill-rank">{{ forloop.counter }}</span>
                  {% endif %}

                  <!-- 아바타(이니셜) + 닉/유저명 -->
                  <div class="d-flex align-items-center gap-2">
                    <span class="avatar">{{ p.user.username|first|upper }}</span>
                    <div class="fw-semibold">{{ p.user.username }}</div>
                  </div>
                </div>

                <div class="text-end">
                  <span class="badge bg-primary"><i class="fas fa-level-up-alt me-1"></i>Lv {{ p.current_level }}</span>
                  <div class="small text-muted mt-1">EXP {{ p.experience_points }} / {{ p.experience_to_next_level }}</div>
                </div>
              </li>
            {% empty %}
              <li class="list-group-item text-center text-muted py-4">데이터가 없습니다.</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>

    <!-- 포인트 순위 -->
    <div class="col-12 col-lg-4">
      <div class="card soft-card h-100">
        <div class="card-header d-flex align-items-center justify-content-between">
          <h5 class="mb-0"><i class="fas fa-coins text-warning me-2"></i>포인트 순위</h5>
          <span class="text-white small">가장 많은 포인트를 보유한 사용자</span>
        </div>
        <div class="card-body p-0">
          <ul class="list-group list-group-flush">
            {% for p in point_leaders %}
              <li class="list-group-item d-flex align-items-center justify-content-between">
                <div class="d-flex align-items-center gap-3">

                  {% if forloop.counter == 1 %}
                    <span class="badge badge-gold rank-badge pill-rank"><i class="fas fa-crown me-1"></i>1</span>
                  {% elif forloop.counter == 2 %}
                    <span class="badge badge-silver rank-badge pill-rank"><i class="fas fa-medal me-1"></i>2</span>
                  {% elif forloop.counter == 3 %}
                    <span class="badge badge-bronze rank-badge pill-rank"><i class="fas fa-medal me-1"></i>3</span>
                  {% else %}
                    <span class="badge bg-light text-muted pill-rank">{{ forloop.counter }}</span>
                  {% endif %}

                  <div class="d-flex align-items-center gap-2">
                    <span class="avatar">{{ p.user.username|first|upper }}</span>
                    <div class="fw-semibold">{{ p.user.username }}</div>
                  </div>
                </div>

                <div class="text-end">
                  <span class="badge bg-info"><i class="fas fa-wallet me-1"></i>{{ p.total_points|default:0 }}점</span>
                  <div class="small text-muted mt-1">완료 퀴즈 {{ p.quizzes_completed|default:0 }}개</div>
                </div>
              </li>
            {% empty %}
              <li class="list-group-item text-center text-muted py-4">데이터가 없습니다.</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>

    <!-- 연속 활동 순위 -->
    <div class="col-12 col-lg-4">
      <div class="card soft-card h-100">
        <div class="card-header d-flex align-items-center justify-content-between">
          <h5 class="mb-0"><i class="fas fa-fire text-danger me-2"></i>연속 활동 순위</h5>
          <span class="text-white small">가장 오래 연속으로 활동한 사용자</span>
        </div>
        <div class="card-body p-0">
          <ul class="list-group list-group-flush">
            {% for p in streak_leaders %}
              <li class="list-group-item d-flex align-items-center justify-content-between">
                <div class="d-flex align-items-center gap-3">

                  {% if forloop.counter == 1 %}
                    <span class="badge badge-gold rank-badge pill-rank"><i class="fas fa-crown me-1"></i>1</span>
                  {% elif forloop.counter == 2 %}
                    <span class="badge badge-silver rank-badge pill-rank"><i class="fas fa-medal me-1"></i>2</span>
                  {% elif forloop.counter == 3 %}
                    <span class="badge badge-bronze rank-badge pill-rank"><i class="fas fa-medal me-1"></i>3</span>
                  {% else %}
                    <span class="badge bg-light text-muted pill-rank">{{ forloop.counter }}</span>
                  {% endif %}

                  <div class="d-flex align-items-center gap-2">
                    <span class="avatar">{{ p.user.username|first|upper }}</span>
                    <div class="fw-semibold">{{ p.user.username }}</div>
                  </div>
                </div>

                <div class="text-end">
                  <span class="badge bg-danger"><i class="fas fa-bolt me-1"></i>{{ p.streak_days|default:0 }}일</span>
                  <div class="small text-muted mt-1">마지막 활동: {{ p.last_activity_date|date:"Y-m-d" }}</div>
                </div>
              </li>
            {% empty %}
              <li class="list-group-item text-center text-muted py-4">데이터가 없습니다.</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- 하단 CTA -->
  <div class="row mt-4">
    <div class="col-12 text-center">
      <a href="{% url 'reward:dashboard' %}" class="btn btn-outline-primary">
        <i class="fas fa-user me-2"></i>내 대시보드
      </a>
    </div>
  </div>

</div>
{% endblock %}
