{% extends "base.html" %}
{% load static %}
{% block title %}퀴즈 결과 - {{ quiz.title }}{% endblock %}

{% block content %}
<div class="container">

  <div class="row mb-4">
    <div class="col-12 d-flex justify-content-between align-items-center">
      <h1 class="h3 fw-bold text-primary mb-0">
        <i class="fas fa-clipboard-check me-2"></i>퀴즈 결과
      </h1>
      <div class="d-flex gap-2">
        <a href="{% url 'reward:quiz_list' %}" class="btn btn-outline-secondary">
          <i class="fas fa-list me-2"></i>목록으로
        </a>
      </div>
    </div>
  </div>

  <div class="card border-0 shadow-sm mb-4">
    <div class="card-body">
      <h5 class="card-title mb-2">{{ quiz.title }}</h5>
      <p class="text-muted mb-3">{{ quiz.description }}</p>
      <p class="fs-5 mb-0">
        총점: <strong>{{ attempt.score }}</strong> / {{ attempt.max_score }}
      </p>
    </div>
  </div>

  <!-- 오답노트 -->
  <div class="card border-0 shadow-sm">
    <div class="card-header">
      <h5 class="mb-0"><i class="fas fa-book-open me-2"></i>오답노트</h5>
    </div>
    <div class="card-body">
      {% for ans in answers %}
        {% with q=ans.question %}
          <div class="mb-4 p-3 border rounded">
            <div class="d-flex align-items-center mb-2">
              {% if ans.is_correct %}
                <span class="badge bg-success me-2"><i class="fas fa-check"></i> 정답</span>
              {% else %}
                <span class="badge bg-danger me-2"><i class="fas fa-times"></i> 오답</span>
              {% endif %}
              <strong>{{ forloop.counter }}. {{ q.question_text }}</strong>
            </div>

            <!-- 보기 목록: 정답/선택 표시 -->
            <ul class="list-unstyled mb-2">
              {% for opt in q.options.all %}
                <li class="mb-1">
                  {% if opt.is_correct %}
                    <span class="badge bg-success me-1">정답</span>
                  {% endif %}
                  {% if ans.selected_option and opt.id == ans.selected_option.id %}
                    <span class="badge bg-primary me-1">내 선택</span>
                  {% endif %}
                  <strong>{{ opt.order }}.</strong> {{ opt.option_text }}
                </li>
              {% endfor %}
            </ul>

            {% if q.explanation %}
              <div class="small text-muted">
                <i class="fas fa-info-circle me-1"></i>{{ q.explanation }}
              </div>
            {% endif %}
          </div>
        {% endwith %}
      {% empty %}
        <div class="text-muted">답안 기록이 없습니다.</div>
      {% endfor %}
    </div>
  </div>

</div>
{% endblock %}
